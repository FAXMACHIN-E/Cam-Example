{% extends "layout.html" %} 

{% block styles %} 
<!-- #container {
  margin: 0px auto;
  width: 500px;
  height: 375px;
  border: 10px #333 solid;
}
#videoElement {
  width: 500px;
  height: 375px;
  background-color: #666;
} -->
{% endblock %} 

{% block scripts %}
<script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>

{% endblock %} 

{% block content %}  
<header>
  <div id="container">     
      <h1>Video interpretation</h1>
      <p style="font-size:25px;color:rgb(3, 3, 134)">
        We will use OpenCV to access client's web camera, perform hand gesture detection, 
        intepret the American Sign Laguage gesture into an English letter, and 
        then serve the output frames to our web browser via the Flask web framework.
      </p>
      <!-- <video autoplay="true" id="videoElement">

      </video> -->
    </div>
</header> 
<video id="#video" autoplay></video>
<br/><br/>
<button id="#capture" class="btn btn-primary">Capture</button>
<p id="#msg" style="font-size:35px;color:rgb(3, 3, 134)"></p>

<script type="text/javascript">
  window.addEventListener("DOMContentLoaded", function() {
    var video = document.getElementById('#video');
    var message = document.getElementById('#msg');

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      const getImage = async () => {
        video.srcObject = await navigator.mediaDevices.getUserMedia({ video: true })
        video.play();
      }
      getImage()
    }

    document.getElementById('#capture').addEventListener('toggle', function() {
      var canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      var context = canvas.getContext('2d');
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(
        function(blob) {
          form = new FormData();
          form.append('image', blob);
          var response = ''
          // https://stackoverflow.com/questions/67389537/send-html-video-object-canvas-to-flask-using-ajax
          $.ajax({
              type: "POST",
              url: "/video_pred",
              data: form,
              processData : false,
              contentType : false, 
              success: function (text) {
                message.textContent = text
              },
              // error: function (data) {
              //     console.log('There was an error uploading your file!');
              // }
          }).done(function () {
              console.log("Capture sent");
          });
        },
        "image/jpg"
      );

      // const getResult = async () => {
      //   var result = await fetch('result', {
      //     method: 'POST',
      //     body: JSON.stringify(data),
      //     headers: { 'Content-Type': 'application/json' }
      //   })

      //   var jsonResult = await result.json()
      //   message.textContent = jsonResult.message
      // }
      // getResult()
    });
  })
</script>
<div class="slide">
    <div id="vis1" class="vis"></div>
    <!--div id="vis2" class="vis"></div>
    <div id="vis3" class="vis"></div-->
</div>

{% endblock %}

